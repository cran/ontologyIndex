---
title: "ontologyIndex guide"
author: "Daniel Greene"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ontologyIndex guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

`ontologyIndex` has a function to create an `ontology_index` object from a given `.obo` file. The package comes with three such an objects: `hpo`, `mpo` and `go`, encapsulating the Human Phenotype Ontology (HPO), Mammalian Phenotype Ontology (MPO) and Gene Ontology (GO) respectively. Here we'll demonstrate the package using the HPO.

```{r}
library(ontologyIndex)
data(hpo)
```

To use an up-to-date version, download the relevant `.obo` file and read it into R using the function `get_ontology`, passing it the file name.

```{r eval=FALSE}
ontology <- get_ontology(file)
```

You can use the functions `get_term_property`, `get_term_names`, `get_term_children`, `get_term_ancestors` and `get_term_parents` to query the `ontology_index` object. For instance:
```{r}
get_term_ancestors(ontology=hpo, term="HP:0001873", as_names=FALSE)
get_term_ancestors(ontology=hpo, term="HP:0001873", as_names=TRUE)
```

However the object is just a list of vectors and lists of term properties, indexed by the IDs of the terms. 

```{r, echo=FALSE}
data.frame(property=names(hpo), class=sapply(hpo, class), stringsAsFactors=FALSE, row.names=NULL)
```

Thus you can also look up properties for a given term using `[` and `[[` as appropriate. This is the best way to use the `ontology_index` if you are operating on multiple terms as it's faster.

```{r}
hpo$name["HP:0001873"]
hpo$id[grep(x=hpo$name, pattern="Thrombocytopenia")]
hpo$ancestors[["HP:0001873"]]
hpo$name[hpo$ancestors[["HP:0001873"]]]
```

## Removing redundant terms

A set of terms, i.e. a character vector of term IDs, may contain ancestor-descendant pairs. The function `minimal_set` removes such pairs so as to leave a *minimal set* of terms, in the sense of the ontology's directed acyclic graph.

```{r}
terms <- c("HP:0001871", "HP:0001873", "HP:0011877")
hpo$name[terms]
minimal_set(hpo, terms)
```

## Finding all ancestors of a set of terms

```{r}
get_ancestors(hpo, c("HP:0001873", "HP:0011877"))
```

## Operating on branches

This example shows how, starting with terms `"Thrombocytopenia"` and `"Autosomal dominant inheritance"` we would remove/prune and intersect with the `"Mode of inheritance"` branch of the ontology. 

```{r}
terms <- c("HP:0001873","HP:0000006")
hpo$name[terms]

mode_of_inheritance <- hpo$id[grep(x=hpo$name, pattern="Mode of inheritance")]
hpo$name[mode_of_inheritance]

#remove mode of inheritance branch
exclude_branches(ontology=hpo, branch_roots=mode_of_inheritance, terms=terms)

#prune down to mode of inheritance root
prune_branches(ontology=hpo, branch_roots=mode_of_inheritance, terms=terms)

#only mode of inheritance branch
intersection_with_branches(ontology=hpo, branch_roots=mode_of_inheritance, terms=terms)
```

## Forcing compatibility

To force terms to be compatible with a particular ontology, use the `force_compatibility` function. This includes attempting to map obsolete terms to non-obsolete terms if they have and alternative id, i.e. 'alt_id' in the .obo file.

```{r}
force_compatibility(hpo, c("HP:0001873","nonsense term"))
```
